IMAGE_REPO ?= quay.io/isim/cbt-aggapi
IMAGE_TAG ?= latest

init_repo:
	apiserver-boot init repo --domain storage.k8s.io

create_group:
	apiserver-boot create group version resource --group cbt --version v1alpha1 --kind VolumeSnapshotDelta

build:
	apiserver-boot build executables

run-local:
	PATH=`pwd`/bin:${PATH} apiserver-boot run local --run "etcd,apiserver"

.PHONY: proto
proto:
	protoc -I=proto \
		--go_out=pkg/grpc --go_opt=paths=source_relative \
   	--go-grpc_out=pkg/grpc --go-grpc_opt=paths=source_relative \
		proto/cbt.proto

.PHONY: yaml
yaml:
	apiserver-boot build config --name cbt --namespace csi-cbt --image $(IMAGE_REPO):$(IMAGE_TAG) --output config

image:
	apiserver-boot build container --targets apiserver --image $(IMAGE_REPO):$(IMAGE_TAG)
